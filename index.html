function calculateEMA(prices, period) {
    if (prices.length === 0) return [];

    const k = 2 / (period + 1); // Множитель сглаживания
    const ema = new Array(prices.length);

    // Начальное значение EMA — это SMA за первый период
    let sma = 0;
    const initialPeriod = Math.min(period, prices.length);
    for (let i = 0; i < initialPeriod; i++) {
        sma += prices[i];
    }
    sma /= initialPeriod;
    ema[initialPeriod - 1] = sma;

    // Рассчитываем EMA для всех последующих значений
    for (let i = initialPeriod; i < prices.length; i++) {
        ema[i] = prices[i] * k + ema[i - 1] * (1 - k);
    }

    // Для значений до начального периода просто копируем первое значение EMA
    // (TradingView обычно отображает EMA только после периода инициализации)
    for (let i = 0; i < initialPeriod - 1; i++) {
        ema[i] = sma; // Можно оставить undefined, если не нужно отображать до периода
    }

    return ema;
}
